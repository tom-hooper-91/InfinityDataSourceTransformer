namespace CostManagement.Test
{
    public class CostManagementTransformerShould
    {
        [TestCase(1)]
        [TestCase(3)]
        [TestCase(5)]
        [TestCase(9)]
        public void Generate_a_list_of_parsed_cost_management_entries_with_accumulated_cost(int index)
        {
            var entries =
                CostManagementTransformer.GenerateListOfEntriesWithAccumulatedCost(GetMockJsonString());
            var entry = entries[index];

            Assert.That(entry.Cost, Is.Positive);
            Assert.That(Convert.ToString(entry.Date), Does.Contain("202402"));
            Assert.That(entry.AccumulatedCost, Is.TypeOf<double>());
            Assert.That(entries[index].AccumulatedCost, Is.EqualTo(entries[index-1].AccumulatedCost + entries[index].Cost));
        }

        private string GetMockJsonString()
        {
            return "{\"Column\":[{\"Name\":\"Cost\",\"Type\":\"Number\"},{\"Name\":\"UsageDate\",\"Type\":\"Number\"},{\"Name\":\"Currency\",\"Type\":\"String\"}],\"ETag\":null,\"Id\":null,\"Location\":null,\"Name\":null,\"NextLink\":null,\"Row\":[[\"4.412745224007622\",\"20240201\",\"GBP\"],[\"4.412738914112919\",\"20240202\",\"GBP\"],[\"4.4134873151186005\",\"20240203\",\"GBP\"],[\"4.5714594303030145\",\"20240204\",\"GBP\"],[\"4.756180020278169\",\"20240205\",\"GBP\"],[\"4.756293598382835\",\"20240206\",\"GBP\"],[\"4.756128752383702\",\"20240207\",\"GBP\"],[\"4.756017540489551\",\"20240208\",\"GBP\"],[\"4.7560238503842545\",\"20240209\",\"GBP\"],[\"4.756022272910578\",\"20240210\",\"GBP\"],[\"4.7560238503842545\",\"20240211\",\"GBP\"],[\"4.72446806697139\",\"20240212\",\"GBP\"],[\"4.756027794068444\",\"20240213\",\"GBP\"],[\"4.756119287541647\",\"20240214\",\"GBP\"],[\"4.756080639436587\",\"20240215\",\"GBP\"],[\"4.7560238503842545\",\"20240216\",\"GBP\"],[\"4.7560238503842545\",\"20240217\",\"GBP\"],[\"4.7560238503842545\",\"20240218\",\"GBP\"],[\"4.75630306322489\",\"20240219\",\"GBP\"],[\"4.756325147856353\",\"20240220\",\"GBP\"],[\"4.756124019962675\",\"20240221\",\"GBP\"],[\"1.9242650308434268\",\"20240222\",\"GBP\"]],\"Sku\":null,\"Tag\":{},\"Type\":null,\"Property\":{\"Column\":[{\"Name\":\"Cost\",\"Type\":\"Number\"},{\"Name\":\"UsageDate\",\"Type\":\"Number\"},{\"Name\":\"Currency\",\"Type\":\"String\"}],\"NextLink\":null,\"Row\":[[\"4.412745224007622\",\"20240201\",\"GBP\"],[\"4.412738914112919\",\"20240202\",\"GBP\"],[\"4.4134873151186005\",\"20240203\",\"GBP\"],[\"4.5714594303030145\",\"20240204\",\"GBP\"],[\"4.756180020278169\",\"20240205\",\"GBP\"],[\"4.756293598382835\",\"20240206\",\"GBP\"],[\"4.756128752383702\",\"20240207\",\"GBP\"],[\"4.756017540489551\",\"20240208\",\"GBP\"],[\"4.7560238503842545\",\"20240209\",\"GBP\"],[\"4.756022272910578\",\"20240210\",\"GBP\"],[\"4.7560238503842545\",\"20240211\",\"GBP\"],[\"4.72446806697139\",\"20240212\",\"GBP\"],[\"4.756027794068444\",\"20240213\",\"GBP\"],[\"4.756119287541647\",\"20240214\",\"GBP\"],[\"4.756080639436587\",\"20240215\",\"GBP\"],[\"4.7560238503842545\",\"20240216\",\"GBP\"],[\"4.7560238503842545\",\"20240217\",\"GBP\"],[\"4.7560238503842545\",\"20240218\",\"GBP\"],[\"4.75630306322489\",\"20240219\",\"GBP\"],[\"4.756325147856353\",\"20240220\",\"GBP\"],[\"4.756124019962675\",\"20240221\",\"GBP\"],[\"1.9242650308434268\",\"20240222\",\"GBP\"]]}}";
        }
    }
}